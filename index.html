<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Surplus Production Model Framework for Northern Shrimp Populations • sspm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Spatial Surplus Production Model Framework for Northern Shrimp Populations">
<meta property="og:description" content="The goal of `sspm` is to implement a gam-based spatial surplus 
    production model, aimed at modeling northern shrimp population in Canada but 
    potentially to any stock in any location. The package is opinionated in its 
    implementation of SPMs as it internally makes the choice to use penalized 
    spatial gams with time lags  based on Pedersen et al. (2020). However, it 
    also aims to provide options for the user to customize their model.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">sspm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pedersen-fisheries-lab/sspm/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="sspm-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#sspm-" class="anchor"></a>sspm <img src="reference/figures/logo.png" align="right" height="150">
</h1></div>
<!-- badges: start -->

<p>The goal of <code>sspm</code> is to implement a gam-based spatial surplus production model, aimed at modeling northern shrimp population in Canada but potentially to any stock in any location. The package is opinionated in its implementation of SPMs as it internally makes the choice to use penalized spatial gams with time lags based on Pedersen et al. (2020). However, it also aims to provide options for the user to customize their model.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<!-- You can install the released version of sspm from [CRAN](https://CRAN.R-project.org) with: -->
<!-- ``` r -->
<!-- install.packages("sspm") -->
<!-- ``` -->
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"pedersen-fisheries-lab/sspm"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>The following example shows the typical <code>sspm</code> workflow. The API is subject to changes as the package is still in development.</p>
<p>Let’s first load the test data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pedersen-fisheries-lab.github.io/sspm/">sspm</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</span>
<span class="co">#&gt; Loading required package: mgcv</span>
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; This is mgcv 1.8-33. For overview type 'help("mgcv-package")'.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>

<span class="va">borealis</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">borealis_simulated</span>
<span class="va">predator</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">predator_simulated</span>
<span class="va">catch</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">catch_simulated</span>
<span class="va">sfa_boundaries</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">sfa_boundaries</span></code></pre></div>
<ol>
<li>Start by creating a base <code>sapspm</code> object with a base dataset called “Biomass”.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sspm.html">sspm</a></span><span class="op">(</span>model_name <span class="op">=</span> <span class="st">"My Model"</span>,
                  boundaries <span class="op">=</span> <span class="va">sfa_boundaries</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/map_dataset.html">map_biomass</a></span><span class="op">(</span><span class="va">borealis</span>, <span class="st">"borealis"</span>, 
              time_column <span class="op">=</span> <span class="st">"year_f"</span>,
              coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'lon_dec'</span>,<span class="st">'lat_dec'</span><span class="op">)</span>,
              uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span><span class="op">)</span>
<span class="co">#&gt; !  Warning: sspm is assuming that the CRS of boundaries is to be used for casting</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_dec, lat_dec</span>
<span class="va">sspm_base</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM object 'My Model' ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Datasets      : 1 dataset</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1541 observations, 18 variables]</span></code></pre></div>
<ol>
<li>Then, discretize the object using a method for discretization, the default behind voronoi tesselation. See <code>?spm_methods()</code> for the list of methods available.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_discrete</span> <span class="op">&lt;-</span> <span class="va">sspm_base</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/spm_discretize.html">spm_discretize</a></span><span class="op">(</span>with_dataset <span class="op">=</span> <span class="st">"borealis"</span>, 
                 discretization_method <span class="op">=</span> <span class="st">"tesselate_voronoi"</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Discretizing using method tesselate_voronoi with dataset borealis</span>
<span class="va">sspm_discrete</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒  SSPM object 'My Model' [DISCRETIZED]  ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [75 features, 19 variables]</span>
<span class="co">#&gt;    ٭ Patches — [69 features, 4 variables]</span>
<span class="co">#&gt; →  Datasets      : 1 dataset</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1026 observations, 21 variables]</span></code></pre></div>
<p>The results of the discretization can be explored with <code><a href="reference/spm_name.html">spm_patches()</a></code> and <code><a href="reference/spm_name.html">spm_points()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/spm_name.html">spm_patches</a></span><span class="op">(</span><span class="va">sspm_discrete</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 69 features and 3 fields</span>
<span class="co">#&gt; geometry type:  POLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -64.5 ymin: 46.00004 xmax: -46.6269 ymax: 61</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt; # A tibble: 69 x 4</span>
<span class="co">#&gt;    sfa   patch_id                                              geometry area_km2</span>
<span class="co">#&gt;  * &lt;chr&gt; &lt;fct&gt;                                            &lt;POLYGON [°]&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 4     V1       ((-64.4227 60.27125, -64.5 60.30667, -64.5 60.31667,…   20236.</span>
<span class="co">#&gt;  2 4     V2       ((-63 60.55308, -63 61, -62.96667 61, -62.93333 61, …   14675.</span>
<span class="co">#&gt;  3 4     V3       ((-59.91648 58.8388, -59.9052 58.80785, -59.9468 58.…    4127.</span>
<span class="co">#&gt;  4 4     V4       ((-59.88688 57.66667, -59.9 57.66667, -59.93333 57.6…    2742.</span>
<span class="co">#&gt;  5 4     V5       ((-62.00478 61, -62 61, -61.96667 61, -61.93333 61, …    5560.</span>
<span class="co">#&gt;  6 4     V6       ((-59.95436 58.6478, -59.9052 58.61004, -59.79427 58…    1515.</span>
<span class="co">#&gt;  7 4     V7       ((-61.86024 57.86301, -61.86024 57.87204, -61.94343 …    3819.</span>
<span class="co">#&gt;  8 4     V8       ((-61.37285 57.66667, -61.4 57.66667, -61.43333 57.6…    4376.</span>
<span class="co">#&gt;  9 4     V9       ((-61.36857 58.4628, -61.66155 59.11637, -60.6936 58…    2702.</span>
<span class="co">#&gt; 10 4     V10      ((-60.25027 59.52148, -60.18251 59.45455, -60.16864 …    2445.</span>
<span class="co">#&gt; # … with 59 more rows</span>
<span class="fu"><a href="reference/spm_name.html">spm_points</a></span><span class="op">(</span><span class="va">sspm_discrete</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 75 features and 18 fields</span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -61.77175 ymin: 46.37211 xmax: -48.19061 ymax: 59.70288</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt; # A tibble: 75 x 19</span>
<span class="co">#&gt; # Groups:   sfa [4]</span>
<span class="co">#&gt;     year vessel  trip div_nafo season area_swept_km2 year_f n_samples lon_dec</span>
<span class="co">#&gt;  * &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1  1995     39    21 3K       Fall           0.0250 1995           5   -56.4</span>
<span class="co">#&gt;  2  1996     39    37 2G       Fall           0.0250 1996           5   -53.0</span>
<span class="co">#&gt;  3  1996     39    37 2G       Fall           0.0250 1996           5   -61.8</span>
<span class="co">#&gt;  4  1998     39    73 2H       Fall           0.0250 1998           5   -56.1</span>
<span class="co">#&gt;  5  1998     39    73 2J       Fall           0.0343 1998           5   -53.2</span>
<span class="co">#&gt;  6  1998     39    76 3L       Fall           0.0250 1998           5   -53.7</span>
<span class="co">#&gt;  7  1999     39    86 2J       Fall           0.0281 1999           5   -57.8</span>
<span class="co">#&gt;  8  1999     39    88 3K       Fall           0.0250 1999           5   -53.6</span>
<span class="co">#&gt;  9  2011     39    98 3K       Fall           0.0281 2011           5   -61.2</span>
<span class="co">#&gt; 10  2006     48   101 2G       Summer         0.0281 2006           5   -56.1</span>
<span class="co">#&gt; # … with 65 more rows, and 10 more variables: lat_dec &lt;dbl&gt;, depth &lt;dbl&gt;,</span>
<span class="co">#&gt; #   temp_at_bottom &lt;dbl&gt;, weight &lt;dbl&gt;, weight_per_km2 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   recruit_weight &lt;dbl&gt;, row &lt;int&gt;, uniqueID &lt;chr&gt;, geometry &lt;POINT [°]&gt;,</span>
<span class="co">#&gt; #   sfa &lt;chr&gt;</span></code></pre></div>
<ol>
<li>Then, other datasets may be loaded alongside the biomass dataset, for example, predator and catch data.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_mapped</span> <span class="op">&lt;-</span> <span class="va">sspm_discrete</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/map_dataset.html">map_predictor</a></span><span class="op">(</span><span class="va">predator</span>,
                name <span class="op">=</span> <span class="st">"pred_data"</span>,
                time_column <span class="op">=</span> <span class="st">"year"</span>,
                uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span>,
                coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon_dec"</span>, <span class="st">"lat_dec"</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; !  Warning: sspm is assuming that the CRS of boundaries is to be used for casting</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_dec, lat_dec</span>
<span class="va">sspm_mapped</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒  SSPM object 'My Model' [DISCRETIZED]  ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [75 features, 19 variables]</span>
<span class="co">#&gt;    ٭ Patches — [69 features, 4 variables]</span>
<span class="co">#&gt; →  Datasets      : 2 datasets</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1026 observations, 21 variables]</span>
<span class="co">#&gt;    ٭ pred_data (predictor) — [1979 observations, 18 variables]</span></code></pre></div>
<ol>
<li>Smoothing formulas for any of the datasets may be specified, using special terms <code><a href="reference/smooth_time.html">smooth_time()</a></code>, <code>smooth_space</code> and <code>smooth_space_time</code>. NOTE: the testing dataset is dummy data and wont converge if <code><a href="reference/smooth_time.html">smooth_time()</a></code> or <code>smooth_space_time</code> is used (to be fixed soon).</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_with_formulas</span> <span class="op">&lt;-</span> <span class="va">sspm_mapped</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/map_formula.html">map_formula</a></span><span class="op">(</span><span class="va">weight_per_km2</span><span class="op">~</span><span class="fu"><a href="reference/smooth_time.html">smooth_time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"borealis"</span>, <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/map_formula.html">map_formula</a></span><span class="op">(</span><span class="va">weight_per_km2</span><span class="op">~</span><span class="fu"><a href="reference/smooth_time.html">smooth_space</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"pred_data"</span><span class="op">)</span>
<span class="va">sspm_with_formulas</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒  SSPM object 'My Model' [DISCRETIZED]  ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [75 features, 19 variables]</span>
<span class="co">#&gt;    ٭ Patches — [69 features, 4 variables]</span>
<span class="co">#&gt; →  Datasets      : 2 datasets</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1026 observations, 21 variables]</span>
<span class="co">#&gt;       – weight_per_km2 ~ smooth_time()</span>
<span class="co">#&gt;    ٭ pred_data (predictor) — [1979 observations, 18 variables]</span>
<span class="co">#&gt;       – weight_per_km2 ~ smooth_space()</span></code></pre></div>
<ol>
<li>Finally, formulas can be fitted with <code><a href="reference/fit_smooths.html">fit_smooths()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_smooth_fitted</span> <span class="op">&lt;-</span> <span class="va">sspm_with_formulas</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/fit_smooths.html">fit_smooths</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Fitting formula: weight_per_km2 ~ smooth_time() for dataset 'borealis'</span>
<span class="co">#&gt; ℹ  Fitting formula: weight_per_km2 ~ smooth_space() for dataset 'pred_data'</span>
<span class="va">sspm_smooth_fitted</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒  SSPM object 'My Model' [DISCRETIZED]  ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [75 features, 19 variables]</span>
<span class="co">#&gt;    ٭ Patches — [69 features, 4 variables]</span>
<span class="co">#&gt; →  Datasets      : 2 datasets</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1026 observations, 21 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_time()</span>
<span class="co">#&gt;    ٭ pred_data (predictor) — [1979 observations, 18 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_space()</span>
<span class="co">#&gt; →  Smoothed data : [1656 observations, 8 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: borealis_smooth — pred_data_smooth</span></code></pre></div>
<ol>
<li>We also need to register catch data. For catch data, it is important to precise a data column which will be aggregated at the <code>patch_id</code> level.</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_smooth_fitted_wcatch</span> <span class="op">&lt;-</span>  <span class="va">sspm_smooth_fitted</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/map_dataset.html">map_catch</a></span><span class="op">(</span><span class="va">catch</span>, name <span class="op">=</span> <span class="st">"catch_data"</span>, 
            time_column <span class="op">=</span> <span class="st">"year_f"</span>, 
            uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span>, 
            coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon_start"</span>, <span class="st">"lat_start"</span><span class="op">)</span>, 
            catch_column <span class="op">=</span> <span class="st">"catch"</span>, 
            biomass_column <span class="op">=</span> <span class="st">"borealis_smooth"</span><span class="op">)</span>
<span class="co">#&gt; !  Warning: sspm is assuming that the CRS of boundaries is to be used for casting</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_start, lat_start</span>
<span class="va">sspm_smooth_fitted_wcatch</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒  SSPM object 'My Model' [DISCRETIZED]  ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [75 features, 19 variables]</span>
<span class="co">#&gt;    ٭ Patches — [69 features, 4 variables]</span>
<span class="co">#&gt; →  Datasets      : 3 datasets</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1026 observations, 21 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_time()</span>
<span class="co">#&gt;    ٭ pred_data (predictor) — [1979 observations, 18 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_space()</span>
<span class="co">#&gt;    ٭ catch_data (catch) — [64943 observations, 11 variables]</span>
<span class="co">#&gt; →  Smoothed data : [1656 observations, 11 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: borealis_smooth — borealis_smooth_with_catch — borealis_smooth_with_catch_change — pred_data_smooth</span></code></pre></div>
<ol>
<li>To fit the final SPM, we might need to add lagged values. This is easily done with <code>spm_lag</code>.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_smooth_fitted_wcatch_lagged</span> <span class="op">&lt;-</span> <span class="va">sspm_smooth_fitted_wcatch</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/spm_lag.html">spm_lag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"borealis_smooth"</span>, <span class="st">"pred_data_smooth"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">sspm_smooth_fitted_wcatch_lagged</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒  SSPM object 'My Model' [DISCRETIZED]  ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [75 features, 19 variables]</span>
<span class="co">#&gt;    ٭ Patches — [69 features, 4 variables]</span>
<span class="co">#&gt; →  Datasets      : 3 datasets</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1026 observations, 21 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_time()</span>
<span class="co">#&gt;    ٭ pred_data (predictor) — [1979 observations, 18 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_space()</span>
<span class="co">#&gt;    ٭ catch_data (catch) — [64943 observations, 11 variables]</span>
<span class="co">#&gt; →  Smoothed data : [1656 observations, 13 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: borealis_smooth — borealis_smooth_with_catch — borealis_smooth_with_catch_change — pred_data_smooth</span>
<span class="co">#&gt;    ٭ lagged vars: borealis_smooth_lag_1 — pred_data_smooth_lag_1</span></code></pre></div>
<ol>
<li>Before fitting the model, we split data into test/train.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_smooth_fitted_wcatch_lagged</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="reference/spm_split.html">spm_split</a></span><span class="op">(</span><span class="va">sspm_smooth_fitted_wcatch_lagged</span>, <span class="va">year_f</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1996</span><span class="op">:</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>
<span class="va">sspm_smooth_fitted_wcatch_lagged</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒  SSPM object 'My Model' [DISCRETIZED]  ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [75 features, 19 variables]</span>
<span class="co">#&gt;    ٭ Patches — [69 features, 4 variables]</span>
<span class="co">#&gt; →  Datasets      : 3 datasets</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1026 observations, 21 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_time()</span>
<span class="co">#&gt;    ٭ pred_data (predictor) — [1979 observations, 18 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_space()</span>
<span class="co">#&gt;    ٭ catch_data (catch) — [64943 observations, 11 variables]</span>
<span class="co">#&gt; →  Smoothed data : [1656 observations, 14 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: borealis_smooth — borealis_smooth_with_catch — borealis_smooth_with_catch_change — pred_data_smooth</span>
<span class="co">#&gt;    ٭ lagged vars: borealis_smooth_lag_1 — pred_data_smooth_lag_1</span>
<span class="co">#&gt;       – [345 train, 1311 test]</span></code></pre></div>
<ol>
<li>We can now map a final spm formula onto the smoothed data</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_smooth_with_formulas</span> <span class="op">&lt;-</span> <span class="va">sspm_smooth_fitted_wcatch_lagged</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/map_formula.html">map_formula</a></span><span class="op">(</span><span class="va">borealis_smooth_with_catch</span> <span class="op">~</span> <span class="va">pred_data_smooth_lag_1</span> <span class="op">+</span> <span class="fu"><a href="reference/smooth_time.html">smooth_lag</a></span><span class="op">(</span><span class="st">"borealis_smooth"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sspm_smooth_with_formulas</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒  SSPM object 'My Model' [DISCRETIZED]  ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 2 variables]</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [75 features, 19 variables]</span>
<span class="co">#&gt;    ٭ Patches — [69 features, 4 variables]</span>
<span class="co">#&gt; →  Datasets      : 3 datasets</span>
<span class="co">#&gt;    ٭ borealis (biomass) — [1026 observations, 21 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_time()</span>
<span class="co">#&gt;    ٭ pred_data (predictor) — [1979 observations, 18 variables]</span>
<span class="co">#&gt;       – (SMOOTHED) weight_per_km2 ~ smooth_space()</span>
<span class="co">#&gt;    ٭ catch_data (catch) — [64943 observations, 11 variables]</span>
<span class="co">#&gt; →  Smoothed data : [1656 observations, 14 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: borealis_smooth — borealis_smooth_with_catch — borealis_smooth_with_catch_change — pred_data_smooth</span>
<span class="co">#&gt;    ٭ lagged vars: borealis_smooth_lag_1 — pred_data_smooth_lag_1</span>
<span class="co">#&gt;       – borealis_smooth_with_catch ~ pred_data_s...</span>
<span class="co">#&gt;       – [345 train, 1311 test]</span></code></pre></div>
<ol>
<li>We can now fit the SPM.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_with_fit</span> <span class="op">&lt;-</span> 
  <span class="va">sspm_smooth_with_formulas</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/fit_smooths.html">fit_spm</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Fitting SPM formula: borealis_smooth_with_catch ~ pred_data_smooth_lag_1 + smooth_lag('borealis_smooth')</span>
<span class="co">#&gt; Warning in estimate.theta(theta, family, G$y, linkinv(eta), scale = scale1, :</span>
<span class="co">#&gt; step failure in theta estimation</span>

<span class="co">#&gt; Warning in estimate.theta(theta, family, G$y, linkinv(eta), scale = scale1, :</span>
<span class="co">#&gt; step failure in theta estimation</span>

<span class="co">#&gt; Warning in estimate.theta(theta, family, G$y, linkinv(eta), scale = scale1, :</span>
<span class="co">#&gt; step failure in theta estimation</span>
<span class="fu"><a href="reference/spm_data.html">spm_smoothed_fit</a></span><span class="op">(</span><span class="fu"><a href="reference/spm_name.html">spm_smoothed_data</a></span><span class="op">(</span><span class="va">sspm_with_fit</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; $smoothed_data_f1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: Scaled t(Inf,71.803) </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; borealis_smooth_with_catch ~ pred_data_smooth_lag_1 + s(lag_matrix, </span>
<span class="co">#&gt;     k = 5, m = 1, by = by_matrix)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated degrees of freedom:</span>
<span class="co">#&gt; 2.92  total = 4.92 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; REML score: 496.6813</span></code></pre></div>
<ol>
<li>We can also extract predictions.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TODO</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/pedersen-fisheries-lab/sspm/">https://​github.com/​pedersen-fisheries-lab/​sspm/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/pedersen-fisheries-lab/sspm/issues">https://​github.com/​pedersen-fisheries-lab/​sspm/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Valentin Lucet <br><small class="roles"> Author, maintainer </small>  </li>
<li>Eric Pedersen <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://opensource.org/licenses/MIT/"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></li>
<li><a href="https://github.com/pedersen-fisheries-lab/sspm/actions"><img src="https://github.com/pedersen-fisheries-lab/sspm/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/pedersen-fisheries-lab/sspm?branch=main"><img src="https://codecov.io/gh/pedersen-fisheries-lab/sspm/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Valentin Lucet, Eric Pedersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
