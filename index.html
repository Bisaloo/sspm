<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Surplus Production Model Framework for Northern Shrimp Populations • sspm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Spatial Surplus Production Model Framework for Northern Shrimp Populations">
<meta property="og:description" content="The goal of `sspm` is to implement a gam-based spatial surplus 
    production model, aimed at modeling northern shrimp population in Canada but 
    potentially to any stock in any location. The package is opinionated in its 
    implementation of SPMs as it internally makes the choice to use penalized 
    spatial gams with time lags  based on Pedersen et al. (2020). However, it 
    also aims to provide options for the user to customize their model.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">sspm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pedersen-fisheries-lab/sspm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="sspm-">sspm <img src="reference/figures/logo.png" align="right" height="150"><a class="anchor" aria-label="anchor" href="#sspm-"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of <code>sspm</code> is to implement a gam-based spatial surplus production model, aimed at modeling northern shrimp population in Canada but potentially to any stock in any location. The package is opinionated in its implementation of SPMs as it internally makes the choice to use penalized spatial gams with time lags based on Pedersen et al. (2020). However, it also aims to provide options for the user to customize their model.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<!-- You can install the released version of sspm from [CRAN](https://CRAN.R-project.org) with: -->
<!-- ``` r -->
<!-- install.packages("sspm") -->
<!-- ``` -->
<p>You can install the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"pedersen-fisheries-lab/sspm"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>The following example shows the typical <code>sspm</code> workflow. The API is subject to changes as the package is still in development.</p>
<p>Let’s first load the packages and the test data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pedersen-fisheries-lab.github.io/sspm/" class="external-link">sspm</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.9.0, GDAL 3.2.2, PROJ 7.2.1; sf_use_s2() is TRUE</span>
<span class="co">#&gt; Loading required package: mgcv</span>
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; This is mgcv 1.8-38. For overview type 'help("mgcv-package")'.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:nlme':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>

<span class="va">borealis</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">borealis_simulated</span>
<span class="va">predator</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">predator_simulated</span>
<span class="va">catch</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">catch_simulated</span>
<span class="va">sfa_boundaries</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">sfa_boundaries</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>The first step of the <code>sspm</code> workflow is to create a <code>sspm_boundary</code> from an <code>sf</code> object, providing the <code>boundary</code> that delineates the boundary regions. The object can then be plotted with <code>spm_plot</code> (as can most <code>sspm</code> objects).</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/spm_as_boundary.html">spm_as_boundary</a></span><span class="op">(</span>boundaries <span class="op">=</span> <span class="va">sfa_boundaries</span>, 
                          boundary <span class="op">=</span> <span class="st">"sfa"</span><span class="op">)</span>

<span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
<ol start="2" style="list-style-type: decimal">
<li>The second step consists in wrapping a <code>data.frame</code>, <code>tibble</code> or <code>sf</code> object into a <code>sspm_data</code> object, with a few other pieces of relevant information, such as the name, dataset type (biomass, predictor or catch, depending on the type of information contained), time column and coordinates column (i not <code>sf</code>) and unique row identifier. Here we wrap the borealis dataset that contains the biomass information.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biomass_dataset</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/spm_as_dataset.html">spm_as_dataset</a></span><span class="op">(</span><span class="va">borealis</span>, name <span class="op">=</span> <span class="st">"borealis"</span>,
                 density <span class="op">=</span> <span class="st">"weight_per_km2"</span>,
                 time <span class="op">=</span> <span class="st">"year_f"</span>,
                 coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lon_dec'</span>,<span class="st">'lat_dec'</span><span class="op">)</span>, 
                 uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_dec, lat_dec</span>
<span class="co">#&gt; !  Warning: sspm is assuming WGS 84 CRS is to be used for casting</span>

<span class="va">biomass_dataset</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Dataset borealis ‒‒</span>
<span class="co">#&gt; →  [1800 rows, 9 columns]</span>
<span class="co">#&gt; →  Density : weight_per_km2</span>
<span class="co">#&gt; →  Time : year_f</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>We do the same with the predator data, which are of the predictor type.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predator_dataset</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/spm_as_dataset.html">spm_as_dataset</a></span><span class="op">(</span><span class="va">predator</span>, name <span class="op">=</span> <span class="st">"all_predators"</span>, 
                 density <span class="op">=</span> <span class="st">"weight_per_km2"</span>,
                 time <span class="op">=</span> <span class="st">"year_f"</span>,
                 coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon_dec"</span>, <span class="st">"lat_dec"</span><span class="op">)</span>,
                 uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_dec, lat_dec</span>
<span class="co">#&gt; !  Warning: sspm is assuming WGS 84 CRS is to be used for casting</span>

<span class="va">predator_dataset</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Dataset all_predators ‒‒</span>
<span class="co">#&gt; →  [10200 rows, 8 columns]</span>
<span class="co">#&gt; →  Density : weight_per_km2</span>
<span class="co">#&gt; →  Time : year_f</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>The <code>sspm</code> workflow relies on the discretization of the boundary objects, the default method being voronoi tesselation.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bounds_voronoi</span> <span class="op">&lt;-</span> <span class="va">bounds</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="reference/spm_discretize.html">spm_discretize</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"tesselate_voronoi"</span>,
                 with <span class="op">=</span> <span class="va">biomass_dataset</span>, 
                 nb_samples <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Discretizing using method tesselate_voronoi</span>

<span class="va">bounds_voronoi</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Boundaries (Discrete) ‒‒</span>
<span class="co">#&gt; →  [4 rows, 3 columns]</span>
<span class="co">#&gt;   ٭ Points — [120 features, 11 columns]</span>
<span class="co">#&gt;   ٭ Patches — [35 features, 4 columns]</span>
<span class="co">#&gt; →  Column : sfa</span>
<span class="co">#&gt; →  Area : area_sfa</span></code></pre></div>
<p>The other available method is <code>triangulate_delaunay</code> for delaunay triangulation. Here the <code>a</code> argument is used to set the size of the mesh (see <code><a href="https://rdrr.io/pkg/RTriangle/man/triangulate.html" class="external-link">RTriangle::triangulate</a></code> for more details).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bounds_delaunay</span> <span class="op">&lt;-</span> <span class="va">bounds</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="reference/spm_discretize.html">spm_discretize</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"triangulate_delaunay"</span>, a <span class="op">=</span> <span class="fl">1</span>, q <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Discretizing using method triangulate_delaunay</span>
<span class="va">bounds_delaunay</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Boundaries (Discrete) ‒‒</span>
<span class="co">#&gt; →  [4 rows, 3 columns]</span>
<span class="co">#&gt;   ٭ Patches — [106 features, 4 columns]</span>
<span class="co">#&gt; →  Column : sfa</span>
<span class="co">#&gt; →  Area : area_sfa</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Plotting the object shows the polygons that have been created.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">bounds_voronoi</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">bounds_delaunay</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"></p>
<ol start="6" style="list-style-type: decimal">
<li>The results of the discretization can also be explored with <code><a href="reference/accessors-methods-sspm_boundary.html">spm_patches()</a></code> and <code><a href="reference/accessors-methods-sspm_boundary.html">spm_points()</a></code>.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/accessors-methods-sspm_boundary.html">spm_patches</a></span><span class="op">(</span><span class="va">bounds_voronoi</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 35 features and 3 fields</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -64.18658 ymin: 46.00004 xmax: -46.6269 ymax: 60.84333</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 35 × 4</span>
<span class="co">#&gt;    sfa   patch_id patch_area                                            geometry</span>
<span class="co">#&gt;  * &lt;fct&gt; &lt;fct&gt;        [km^2]                                       &lt;POLYGON [°]&gt;</span>
<span class="co">#&gt;  1 4     P1           31350. ((-61.49885 58.11503, -61.24738 58.14026, -60.7703…</span>
<span class="co">#&gt;  2 4     P2           11607. ((-60.77034 60.02342, -61.24738 58.14026, -59.6984…</span>
<span class="co">#&gt;  3 4     P3            4619. ((-59.37831 57.67423, -59.43377 57.71988, -59.4892…</span>
<span class="co">#&gt;  4 5     P4           13657. ((-56.7447 54.34709, -56.66417 54.34705, -56.66416…</span>
<span class="co">#&gt;  5 5     P5           14514. ((-59.6728 55.88317, -59.58696 55.95008, -58.97613…</span>
<span class="co">#&gt;  6 5     P6           15164. ((-58.97613 57.16068, -59.58696 55.95008, -57.4711…</span>
<span class="co">#&gt;  7 5     P7            6354. ((-57.48427 54.91192, -57.4711 55.3424, -59.58696 …</span>
<span class="co">#&gt;  8 5     P8            7935. ((-55 54.75, -54.37418 54.75322, -53.92907 54.7535…</span>
<span class="co">#&gt;  9 5     P9            5235. ((-56.72208 54.49769, -56.56636 55.50528, -56.6883…</span>
<span class="co">#&gt; 10 6     P10           9317. ((-52.69796 49.24956, -52.9605 49.75061, -54.76086…</span>
<span class="co">#&gt; # … with 25 more rows</span>
<span class="fu"><a href="reference/accessors-methods-sspm_boundary.html">spm_points</a></span><span class="op">(</span><span class="va">bounds_voronoi</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 120 features and 10 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -62.7333 ymin: 46.10625 xmax: -47.27537 ymax: 60.35241</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 120 × 11</span>
<span class="co">#&gt; # Groups:   sfa [4]</span>
<span class="co">#&gt;    year_f sfa   weight_per_km2 temp_at_bottom lon_dec lat_dec   row uniqueID   </span>
<span class="co">#&gt;  * &lt;fct&gt;  &lt;chr&gt;      [kg/km^2]          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;      </span>
<span class="co">#&gt;  1 1995   7                0            1.45    -58.8    56.3     6 y1995s7r6  </span>
<span class="co">#&gt;  2 1995   5                0            0       -50.6    50.6    51 y1995s5r51 </span>
<span class="co">#&gt;  3 1996   7              759.           0.605   -55.5    50.2    69 y1996s7r69 </span>
<span class="co">#&gt;  4 1996   6            13293.           3.00    -53.4    46.4   100 y1996s6r100</span>
<span class="co">#&gt;  5 1996   5                0            0.934   -52.8    52.2   113 y1996s5r113</span>
<span class="co">#&gt;  6 1996   4             2050.           2.92    -53.1    50.8   125 y1996s4r125</span>
<span class="co">#&gt;  7 1997   7             1368.           0       -57.4    55.1   147 y1997s7r147</span>
<span class="co">#&gt;  8 1997   6               85.4          2.31    -50.7    47.7   176 y1997s6r176</span>
<span class="co">#&gt;  9 1997   4                0            5.18    -60.9    59.6   182 y1997s4r182</span>
<span class="co">#&gt; 10 1997   5             4535.           1.27    -51.5    49.3   206 y1997s5r206</span>
<span class="co">#&gt; # … with 110 more rows, and 3 more variables: geometry &lt;POINT [°]&gt;,</span>
<span class="co">#&gt; #   sfa_duplicate &lt;fct&gt;, area_sfa [km^2]</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>The next step in this workflow is to smooth the variables to be used in the final <code>sspm</code> model, by using spatial-temporal smoothers, by passing each dataset through <code>spm_smooth</code>. Here we first smooth <code>weight_per_km2</code> as well as <code>temp_at_bottom</code>. Note that the boundary column <code>sfa</code> can be used in the formula as the data will be first joined to the provided boundaries.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biomass_smooth</span> <span class="op">&lt;-</span> <span class="va">biomass_dataset</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>  
  <span class="fu"><a href="reference/spm_smooth.html">spm_smooth</a></span><span class="op">(</span><span class="va">weight_per_km2</span> <span class="op">~</span> <span class="va">sfa</span> <span class="op">+</span> <span class="fu"><a href="reference/smooths.html">smooth_time</a></span><span class="op">(</span>by<span class="op">=</span><span class="va">sfa</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/smooths.html">smooth_space</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
               <span class="fu"><a href="reference/smooths.html">smooth_space_time</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span>,
             boundaries <span class="op">=</span> <span class="va">bounds_voronoi</span>, 
             family<span class="op">=</span><span class="va">tw</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="reference/spm_smooth.html">spm_smooth</a></span><span class="op">(</span><span class="va">temp_at_bottom</span> <span class="op">~</span> <span class="fu"><a href="reference/smooths.html">smooth_time</a></span><span class="op">(</span>by<span class="op">=</span><span class="va">sfa</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/smooths.html">smooth_space</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
               <span class="fu"><a href="reference/smooths.html">smooth_space_time</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span>,
             family<span class="op">=</span><span class="va">gaussian</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Fitting formula: weight_per_km2 ~ sfa + smooth_time(by = sfa) + smooth_space() + smooth_space_time(k = c(NA, 30)) for dataset 'borealis'</span>
<span class="co">#&gt; ℹ  Note:  response variable temp_at_bottom is NOT a biomass density variable</span>
<span class="co">#&gt; ℹ  Fitting formula: temp_at_bottom ~ smooth_time(by = sfa) + smooth_space() + smooth_space_time(k = c(NA, 30)) for dataset 'borealis'</span>

<span class="va">biomass_smooth</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Dataset borealis (Mapped) ‒‒</span>
<span class="co">#&gt; →  [1801 rows, 12 columns]</span>
<span class="co">#&gt; →  Density : weight_per_km2</span>
<span class="co">#&gt; →  Time : year_f</span>
<span class="co">#&gt; →  Smoothed data : [840 rows, 8 columns]</span>
<span class="co">#&gt;    ٭ Smoothed vars: temp_at_bottom — weight_per_km2</span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>The smoothed results for any smoothed variables (listed in “smoothed vars” above) can be easily plotted:</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">biomass_smooth</span>, var <span class="op">=</span> <span class="st">"weight_per_km2"</span>, log <span class="op">=</span> <span class="cn">FALSE</span>, aggregate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png" width="100%"> You can also make a spatial plot</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">biomass_smooth</span>, var <span class="op">=</span> <span class="st">"weight_per_km2"</span>, use_sf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png" width="100%"></p>
<ol start="9" style="list-style-type: decimal">
<li>We also smooth the <code>weight_per_km2</code> variable in the predator data.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predator_smooth</span> <span class="op">&lt;-</span> <span class="va">predator_dataset</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>  
  <span class="fu"><a href="reference/spm_smooth.html">spm_smooth</a></span><span class="op">(</span><span class="va">weight_per_km2</span> <span class="op">~</span> <span class="fu"><a href="reference/smooths.html">smooth_time</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/smooths.html">smooth_space</a></span><span class="op">(</span><span class="op">)</span>,
             boundaries <span class="op">=</span> <span class="va">bounds_voronoi</span>,
             drop.unused.levels <span class="op">=</span> <span class="cn">F</span>, family<span class="op">=</span><span class="va">tw</span>, method<span class="op">=</span> <span class="st">"fREML"</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Fitting formula: weight_per_km2 ~ smooth_time(k = 3) + smooth_space() for dataset 'all_predators'</span>
<span class="co">#&gt; Warning in bgam.fit(G, mf, chunk.size, gp, scale, gamma, method = method, :</span>
<span class="co">#&gt; algorithm did not converge</span>

<span class="va">predator_smooth</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Dataset all_predators (Mapped) ‒‒</span>
<span class="co">#&gt; →  [10201 rows, 11 columns]</span>
<span class="co">#&gt; →  Density : weight_per_km2</span>
<span class="co">#&gt; →  Time : year_f</span>
<span class="co">#&gt; →  Smoothed data : [1400 rows, 7 columns]</span>
<span class="co">#&gt;    ٭ Smoothed vars: weight_per_km2</span></code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>Before we assemble the full model with our newly smoothed data, we need to deal with the catch data. We first load the dataset.</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">catch_dataset</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/spm_as_dataset.html">spm_as_dataset</a></span><span class="op">(</span><span class="va">catch</span>, name <span class="op">=</span> <span class="st">"catch_data"</span>, 
                 biomass <span class="op">=</span> <span class="st">"catch"</span>,
                 time <span class="op">=</span> <span class="st">"year_f"</span>, 
                 uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span>, 
                 coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon_dec"</span>, <span class="st">"lat_dec"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_dec, lat_dec</span>
<span class="co">#&gt; !  Warning: sspm is assuming WGS 84 CRS is to be used for casting</span>

<span class="va">catch_dataset</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Dataset catch_data ‒‒</span>
<span class="co">#&gt; →  [2020 rows, 8 columns]</span>
<span class="co">#&gt; →  Biomass : catch</span>
<span class="co">#&gt; →  Time : year_f</span></code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li>We then need to aggregate this data. This illustrate using the <code>spm_aggregate</code> functions. Here we use <code>spm_aggregate_catch</code>:</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biomass_smooth_w_catch</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/spm_aggregate_catch.html">spm_aggregate_catch</a></span><span class="op">(</span>biomass <span class="op">=</span> <span class="va">biomass_smooth</span>, 
                      catch <span class="op">=</span> <span class="va">catch_dataset</span>, 
                      biomass_variable <span class="op">=</span> <span class="st">"weight_per_km2"</span>,
                      catch_variable <span class="op">=</span> <span class="st">"catch"</span>,
                      fill <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Offsetting biomass with catch data using columns: weight_per_km2, catch</span>

<span class="va">biomass_smooth_w_catch</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Dataset borealis (Mapped) ‒‒</span>
<span class="co">#&gt; →  [1801 rows, 12 columns]</span>
<span class="co">#&gt; →  Density : weight_per_km2</span>
<span class="co">#&gt; →  Time : year_f</span>
<span class="co">#&gt; →  Smoothed data : [840 rows, 13 columns]</span>
<span class="co">#&gt;    ٭ Smoothed vars: temp_at_bottom — weight_per_km2</span>
<span class="co">#&gt;    ٭ Vars with catch: weight_per_km2_borealis_with_catch</span></code></pre></div>
<ol start="12" style="list-style-type: decimal">
<li>Once data has been smoothed, we can assemble a <code>sspm</code> model object, using one dataset of type biomass, one dataset of type predictor and (optionnaly) a dataset of type catch.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sspm-constructor.html">sspm</a></span><span class="op">(</span>biomass <span class="op">=</span> <span class="va">biomass_smooth_w_catch</span>, 
                   predictors <span class="op">=</span> <span class="va">predator_smooth</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Joining smoothed data from all datasets</span>

<span class="va">sspm_model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Model (2 datasets) ‒‒</span>
<span class="co">#&gt; →  Smoothed data : [840 rows, 14 columns]</span>
<span class="co">#&gt;    ٭ Smoothed vars: temp_at_bottom — weight_per_km2_all_predators — weight_per_km2_borealis</span>
<span class="co">#&gt;    ٭ Vars with catch: weight_per_km2_borealis_with_catch</span></code></pre></div>
<ol start="13" style="list-style-type: decimal">
<li>Before fitting the model, we must split data into test/train with <code>spm_split</code>.</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_model</span> <span class="op">&lt;-</span> <span class="va">sspm_model</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="reference/spm_split.html">spm_split</a></span><span class="op">(</span><span class="va">year_f</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1990</span><span class="op">:</span><span class="fl">2017</span><span class="op">)</span><span class="op">)</span>

<span class="va">sspm_model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Model (2 datasets) ‒‒</span>
<span class="co">#&gt; →  Smoothed data : [840 rows, 15 columns] / [805 train, 35 test]</span>
<span class="co">#&gt;    ٭ Smoothed vars: temp_at_bottom — weight_per_km2_all_predators — weight_per_km2_borealis</span>
<span class="co">#&gt;    ٭ Vars with catch: weight_per_km2_borealis_with_catch</span></code></pre></div>
<ol start="14" style="list-style-type: decimal">
<li>To fit the model, we might be interested in including lagged values. This is done with <code>spm_lag</code>.</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_model</span> <span class="op">&lt;-</span> <span class="va">sspm_model</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="reference/spm_lag.html">spm_lag</a></span><span class="op">(</span>vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight_per_km2_borealis_with_catch"</span>, 
                   <span class="st">"weight_per_km2_all_predators"</span><span class="op">)</span>, 
          n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">sspm_model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Model (2 datasets) ‒‒</span>
<span class="co">#&gt; →  Smoothed data : [840 rows, 17 columns] / [805 train, 35 test]</span>
<span class="co">#&gt;    ٭ Smoothed vars: temp_at_bottom — weight_per_km2_all_predators — weight_per_km2_borealis</span>
<span class="co">#&gt;    ٭ Vars with catch: weight_per_km2_borealis_with_catch — weight_per_km2_borealis_with_catch_lag_1</span>
<span class="co">#&gt;    ٭ lagged vars: weight_per_km2_all_predators_lag_1 — weight_per_km2_borealis_with_catch_lag_1</span></code></pre></div>
<ol start="15" style="list-style-type: decimal">
<li>We can now fit the final spm model with <code>spm</code>.</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_model_fit</span> <span class="op">&lt;-</span> <span class="va">sspm_model</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="reference/spm.html">spm</a></span><span class="op">(</span><span class="va">log_productivity</span> <span class="op">~</span> <span class="va">sfa</span> <span class="op">+</span>
        <span class="va">weight_per_km2_all_predators_lag_1</span> <span class="op">+</span>
        <span class="fu"><a href="reference/smooths.html">smooth_lag</a></span><span class="op">(</span><span class="st">"weight_per_km2_borealis_with_catch"</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu"><a href="reference/smooths.html">smooth_space</a></span><span class="op">(</span><span class="op">)</span>, 
      family <span class="op">=</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/mgcv/man/scat.html" class="external-link">scat</a></span><span class="op">)</span>
<span class="co">#&gt; ℹ  Fitting SPM formula: log_productivity ~ sfa + weight_per_km2_all_predators_lag_1 + smooth_lag('weight_per_km2_borealis_with_catch') + smooth_space()</span>

<span class="va">sspm_model_fit</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ Model fit ‒‒</span>
<span class="co">#&gt; →  Smoothed data : [840 rows, 17 columns] / [805 train, 35 test]</span>
<span class="co">#&gt; →  Fit summary : </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: Scaled t(7.607,0.19) </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; log_productivity ~ sfa + weight_per_km2_all_predators_lag_1 + </span>
<span class="co">#&gt;     s(lag_matrix, k = 5, m = 1, by = by_matrix) + s(patch_id, </span>
<span class="co">#&gt;     k = 30, bs = "mrf", xt = list(penalty = pen_mat_space))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parametric coefficients:</span>
<span class="co">#&gt;                                     Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)                        5.896e-01  6.189e-02   9.525  &lt; 2e-16 ***</span>
<span class="co">#&gt; sfa5                               5.405e-02  3.240e-02   1.668  0.09568 .  </span>
<span class="co">#&gt; sfa6                               9.308e-02  3.022e-02   3.080  0.00214 ** </span>
<span class="co">#&gt; sfa7                               7.824e-02  3.071e-02   2.548  0.01103 *  </span>
<span class="co">#&gt; weight_per_km2_all_predators_lag_1 1.244e-05  1.800e-05   0.691  0.48990    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Approximate significance of smooth terms:</span>
<span class="co">#&gt;                           edf Ref.df       F p-value    </span>
<span class="co">#&gt; s(lag_matrix):by_matrix 4.958      5 117.482  &lt;2e-16 ***</span>
<span class="co">#&gt; s(patch_id)             1.006     28   7.471  &lt;2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R-sq.(adj) =  0.758   Deviance explained = 53.3%</span>
<span class="co">#&gt; -REML =   1135  Scale est. = 1         n = 770</span></code></pre></div>
<ol start="16" style="list-style-type: decimal">
<li>Plotting the object produces a actual vs predicted plot (with TEST/TRAIN data highlighted.</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">sspm_model_fit</span>, train_test <span class="op">=</span> <span class="cn">TRUE</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 35 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-21-1.png" width="100%"></p>
<ol start="17" style="list-style-type: decimal">
<li>We can also extract the predictions.</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/predict.html">predict</a></span><span class="op">(</span><span class="va">sspm_model_fit</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 6 features and 6 fields</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -64.18658 ymin: 58.11503 xmax: -60.77034 ymax: 60.84333</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;      pred_log      pred patch_id year_f sfa      patch_area</span>
<span class="co">#&gt; 1 -0.02730678 0.9730627       P1   1995   4 31350.28 [km^2]</span>
<span class="co">#&gt; 2 -0.19554690 0.8223848       P1   1996   4 31350.28 [km^2]</span>
<span class="co">#&gt; 3  0.05315999 1.0545984       P1   1997   4 31350.28 [km^2]</span>
<span class="co">#&gt; 4 -0.01628782 0.9838441       P1   1998   4 31350.28 [km^2]</span>
<span class="co">#&gt; 5  0.03051588 1.0309863       P1   1999   4 31350.28 [km^2]</span>
<span class="co">#&gt; 6  0.01365585 1.0137495       P1   2000   4 31350.28 [km^2]</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 2 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 3 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 4 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 5 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 6 POLYGON ((-61.49885 58.1150...</span></code></pre></div>
<p>We can also get the predictions for biomass by passing the biomass variable name.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biomass_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/predict.html">predict</a></span><span class="op">(</span><span class="va">sspm_model_fit</span>, biomass <span class="op">=</span> <span class="st">"weight_per_km2_borealis"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">biomass_preds</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 6 features and 8 fields</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -64.18658 ymin: 58.11503 xmax: -60.77034 ymax: 60.84333</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;   patch_id year_f sfa      patch_area biomass_density_with_catch</span>
<span class="co">#&gt; 1       P1   1995   4 31350.28 [km^2]         3647.214 [kg/km^2]</span>
<span class="co">#&gt; 2       P1   1996   4 31350.28 [km^2]         2374.311 [kg/km^2]</span>
<span class="co">#&gt; 3       P1   1997   4 31350.28 [km^2]         2808.305 [kg/km^2]</span>
<span class="co">#&gt; 4       P1   1998   4 31350.28 [km^2]         2627.772 [kg/km^2]</span>
<span class="co">#&gt; 5       P1   1999   4 31350.28 [km^2]         2632.060 [kg/km^2]</span>
<span class="co">#&gt; 6       P1   2000   4 31350.28 [km^2]         2542.133 [kg/km^2]</span>
<span class="co">#&gt;      biomass_density biomass_with_catch        biomass</span>
<span class="co">#&gt; 1 3646.640 [kg/km^2]     114341186 [kg] 114323179 [kg]</span>
<span class="co">#&gt; 2 2374.120 [kg/km^2]      74435325 [kg]  74429343 [kg]</span>
<span class="co">#&gt; 3 2807.640 [kg/km^2]      88041135 [kg]  88020295 [kg]</span>
<span class="co">#&gt; 4 2627.087 [kg/km^2]      82381383 [kg]  82359909 [kg]</span>
<span class="co">#&gt; 5 2631.644 [kg/km^2]      82515821 [kg]  82502764 [kg]</span>
<span class="co">#&gt; 6 2541.481 [kg/km^2]      79696589 [kg]  79676157 [kg]</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 2 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 3 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 4 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 5 POLYGON ((-61.49885 58.1150...</span>
<span class="co">#&gt; 6 POLYGON ((-61.49885 58.1150...</span></code></pre></div>
<p>We can also predict the biomass one step ahead.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biomass_one_step</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/predict.html">predict</a></span><span class="op">(</span><span class="va">sspm_model_fit</span>, biomass <span class="op">=</span> <span class="st">"weight_per_km2_borealis"</span>, 
                            next_ts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">biomass_one_step</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 6 features and 5 fields</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -64.18658 ymin: 53.85362 xmax: -54.70013 ymax: 60.84333</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 6 × 6</span>
<span class="co">#&gt;   patch_id year_f sfa     biomass patch_area                            geometry</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt;      [kg]     [km^2]                       &lt;POLYGON [°]&gt;</span>
<span class="co">#&gt; 1 P1         2019 4      2226128.     31350. ((-61.49885 58.11503, -61.24738 58…</span>
<span class="co">#&gt; 2 P2         2019 4       916547.     11607. ((-60.77034 60.02342, -61.24738 58…</span>
<span class="co">#&gt; 3 P3         2019 4       330255.      4619. ((-59.37831 57.67423, -59.43377 57…</span>
<span class="co">#&gt; 4 P4         2019 5       800544.     13657. ((-56.7447 54.34709, -56.66417 54.…</span>
<span class="co">#&gt; 5 P5         2019 5      1115285.     14514. ((-59.6728 55.88317, -59.58696 55.…</span>
<span class="co">#&gt; 6 P6         2019 5     32536070.     15164. ((-58.97613 57.16068, -59.58696 55…</span></code></pre></div>
<ol start="18" style="list-style-type: decimal">
<li>We can produce an array of plots, as timeseries or as spatial plots</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">sspm_model_fit</span>, log <span class="op">=</span> <span class="cn">T</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 1 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Warning: Removed 35 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-25-1.png" width="100%"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">sspm_model_fit</span>, log <span class="op">=</span> <span class="cn">T</span>, use_sf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-25-2.png" width="100%"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">sspm_model_fit</span>, biomass <span class="op">=</span> <span class="st">"weight_per_km2_borealis"</span>,  scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-26-1.png" width="100%"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">sspm_model_fit</span>, biomass <span class="op">=</span> <span class="st">"weight_per_km2_borealis"</span>, use_sf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-26-2.png" width="100%"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">sspm_model_fit</span>, biomass <span class="op">=</span> <span class="st">"weight_per_km2_borealis"</span>, 
     next_ts <span class="op">=</span> <span class="cn">TRUE</span>, aggregate <span class="op">=</span> <span class="cn">TRUE</span>, scales <span class="op">=</span> <span class="st">"free"</span>, interval <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning</span>
<span class="co">#&gt; -Inf</span>

<span class="co">#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning</span>
<span class="co">#&gt; -Inf</span>

<span class="co">#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning</span>
<span class="co">#&gt; -Inf</span>

<span class="co">#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning</span>
<span class="co">#&gt; -Inf</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-27-1.png" width="100%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/pedersen-fisheries-lab/sspm/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/pedersen-fisheries-lab/sspm/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing sspm</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Valentin Lucet <br><small class="roles"> Author, maintainer </small>  </li>
<li>Eric Pedersen <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://opensource.org/licenses/MIT/" class="external-link"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></li>
<li><a href="https://github.com/pedersen-fisheries-lab/sspm/actions" class="external-link"><img src="https://github.com/pedersen-fisheries-lab/sspm/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/pedersen-fisheries-lab/sspm?branch=main" class="external-link"><img src="https://codecov.io/gh/pedersen-fisheries-lab/sspm/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Valentin Lucet, Eric Pedersen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
