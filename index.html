<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Surplus Production Model Framework for Northern Shrimp Populations • sspm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Spatial Surplus Production Model Framework for Northern Shrimp Populations">
<meta property="og:description" content="The goal of `sspm` is to implement a gam-based spatial surplus 
    production model, aimed at modeling northern shrimp population in Canada but 
    potentially to any stock in any location. The package is opinionated in its 
    implementation of SPMs as it internally makes the choice to use penalized 
    spatial gams with time lags  based on Pedersen et al. (2020). However, it 
    also aims to provide options for the user to customize their model.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">sspm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pedersen-fisheries-lab/sspm/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="sspm-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#sspm-" class="anchor"></a>sspm <img src="reference/figures/logo.png" align="right" height="150">
</h1></div>
<!-- badges: start -->

<p>The goal of <code>sspm</code> is to implement a gam-based spatial surplus production model, aimed at modeling northern shrimp population in Canada but potentially to any stock in any location. The package is opinionated in its implementation of SPMs as it internally makes the choice to use penalized spatial gams with time lags based on Pedersen et al. (2020). However, it also aims to provide options for the user to customize their model.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<!-- You can install the released version of sspm from [CRAN](https://CRAN.R-project.org) with: -->
<!-- ``` r -->
<!-- install.packages("sspm") -->
<!-- ``` -->
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"pedersen-fisheries-lab/sspm"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>The following example shows the typical <code>sspm</code> workflow. The API is subject to changes as the package is still in development.</p>
<p>Let’s first load the packages and the test data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pedersen-fisheries-lab.github.io/sspm/">sspm</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.9.0, GDAL 3.2.2, PROJ 7.2.1</span>
<span class="co">#&gt; Loading required package: mgcv</span>
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; This is mgcv 1.8-36. For overview type 'help("mgcv-package")'.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>

<span class="va">borealis</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">borealis_simulated</span>
<span class="va">predator</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">predator_simulated</span>
<span class="va">catch</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">catch_simulated</span>

<span class="va">sfa_boundaries</span> <span class="op">&lt;-</span> <span class="fu">sspm</span><span class="fu">:::</span><span class="va">sfa_boundaries</span></code></pre></div>
<ol>
<li>The first step of the <code>sspm</code> workflow is to create a <code>sspm_boundary</code> from an <code>sf</code> object, providing the <code>boundary_column</code> that delineates the boundary regions. The object can then be plotted with <code>spm_plot</code> (as can most <code>sspm</code> objects).</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/spm_as_boundary.html">spm_as_boundary</a></span><span class="op">(</span>boundaries <span class="op">=</span> <span class="va">sfa_boundaries</span>, 
                          boundary_column <span class="op">=</span> <span class="st">"sfa"</span><span class="op">)</span>

<span class="fu"><a href="reference/spm_plot.html">spm_plot</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
<ol>
<li>The second step consists in wrapping a <code>data.frame</code>, <code>tibble</code> or <code>sf</code> object into a <code>sspm_data</code> object, with a few other pieces of relevant information, such as the name, dataset type (biomass, predictor or catch, depending on the type of information contained), time column and coordinates column (i not <code>sf</code>) and unique row identifier. Here we wrap the borealis dataset that contains the biomass information.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biomass_dataset</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/spm_as_dataset.html">spm_as_dataset</a></span><span class="op">(</span><span class="va">borealis</span>, name <span class="op">=</span> <span class="st">"borealis"</span>, 
                 type <span class="op">=</span> <span class="st">"biomass"</span>, time_column <span class="op">=</span> <span class="st">"year_f"</span>,
                 coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'lon_dec'</span>,<span class="st">'lat_dec'</span><span class="op">)</span>, uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_dec, lat_dec</span>
<span class="co">#&gt; !  Warning: sspm is assuming WGS 84 CRS is to be used for casting</span>

<span class="va">biomass_dataset</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Dataset: borealis (biomass) ‒‒</span>
<span class="co">#&gt; →  Data              : [1541 observations, 18 variables]</span>
<span class="co">#&gt; →  Data unique ID    : uniqueID</span>
<span class="co">#&gt; →  Time col.         : year_f</span>
<span class="co">#&gt; →  Coordinates cols. : lon_dec, lat_dec</span></code></pre></div>
<ol>
<li>We do the same with the predator data, which are of the predictor type.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predator_dataset</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/spm_as_dataset.html">spm_as_dataset</a></span><span class="op">(</span><span class="va">predator</span>, name <span class="op">=</span> <span class="st">"all_predators"</span>, 
                 type <span class="op">=</span> <span class="st">"predictor"</span>, time_column <span class="op">=</span> <span class="st">"year"</span>,
                 uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon_dec"</span>, <span class="st">"lat_dec"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_dec, lat_dec</span>
<span class="co">#&gt; !  Warning: sspm is assuming WGS 84 CRS is to be used for casting</span>

<span class="va">predator_dataset</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Dataset: all_predators (predictor) ‒‒</span>
<span class="co">#&gt; →  Data              : [4833 observations, 15 variables]</span>
<span class="co">#&gt; →  Data unique ID    : uniqueID</span>
<span class="co">#&gt; →  Time col.         : year</span>
<span class="co">#&gt; →  Coordinates cols. : lon_dec, lat_dec</span></code></pre></div>
<ol>
<li>The <code>sspm</code> workflow relies on the discretization of the boundary objects, the default method being voronoi tesselation (only one method available currently, but see in the future see <code>?spm_methods()</code> for the list of methods available).</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bounds_voronoi</span> <span class="op">&lt;-</span> <span class="va">bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/spm_discretize.html">spm_discretize</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"tesselate_voronoi"</span>,
                 with <span class="op">=</span> <span class="va">biomass_dataset</span>, 
                 nb_samples <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Discretizing using method tesselate_voronoi</span>

<span class="va">bounds_voronoi</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Boundary (Discrete) ‒‒</span>
<span class="co">#&gt; →  Boundaries    : [4 observations, 3 variables]</span>
<span class="co">#&gt; →  Boundary col. : sfa</span>
<span class="co">#&gt; →  Surface col.  : area</span>
<span class="co">#&gt; →  Discretized   : </span>
<span class="co">#&gt;    ٭ Points — [40 features, 20 variables]</span>
<span class="co">#&gt;    ٭ Patches — [38 features, 4 variables]</span></code></pre></div>
<ol>
<li>Plotting the object shows the polygons that have been created.</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/spm_plot.html">spm_plot</a></span><span class="op">(</span><span class="va">bounds_voronoi</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="100%"></p>
<ol>
<li>The results of the discretization can also be explored with <code><a href="reference/spm_boundaries,sspm_boundary-method.html">spm_patches()</a></code> and <code><a href="reference/spm_boundaries,sspm_boundary-method.html">spm_points()</a></code>.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/spm_boundaries,sspm_boundary-method.html">spm_patches</a></span><span class="op">(</span><span class="va">bounds_voronoi</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 38 features and 3 fields</span>
<span class="co">#&gt; Geometry type: GEOMETRY</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -64.5 ymin: 46.00004 xmax: -46.6269 ymax: 61</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 38 x 4</span>
<span class="co">#&gt;    sfa   patch_id                                              geometry     area</span>
<span class="co">#&gt;  * &lt;chr&gt; &lt;fct&gt;                                            &lt;POLYGON [°]&gt;   [km^2]</span>
<span class="co">#&gt;  1 4     V1       ((-64.42169 60.27125, -64.42 60.27206, -64.41666 60.… 20367.3…</span>
<span class="co">#&gt;  2 4     V2       ((-59.95566 58.64882, -60.25261 57.73692, -59.67678 …  1718.5…</span>
<span class="co">#&gt;  3 4     V3       ((-61.89804 57.6918, -61.34602 58.43681, -61.36857 5…  3882.6…</span>
<span class="co">#&gt;  4 4     V4       ((-60.50931 57.66667, -60.87958 58.41518, -61.34602 …  4684.4…</span>
<span class="co">#&gt;  5 4     V5       ((-61.34602 58.43681, -60.87958 58.41518, -60.68359 …  2687.3…</span>
<span class="co">#&gt;  6 4     V6       ((-63 60.62184, -61.66155 59.11637, -60.6936 58.9027… 14504.2…</span>
<span class="co">#&gt;  7 4     V7       ((-60.26194 59.52858, -60.73068 59.34113, -60.6936 5…  2449.3…</span>
<span class="co">#&gt;  8 4     V8       ((-59.91649 58.83888, -60.68359 58.8793, -60.87958 5…  6258.8…</span>
<span class="co">#&gt;  9 4     V9       ((-61.96379 61, -60.73068 59.34113, -60.26194 59.528…  5308.1…</span>
<span class="co">#&gt; 10 5     V10      ((-59.55703 55.21506, -59.53354 57.66667, -59.56667 … 27939.6…</span>
<span class="co">#&gt; # … with 28 more rows</span>
<span class="fu"><a href="reference/spm_boundaries,sspm_boundary-method.html">spm_points</a></span><span class="op">(</span><span class="va">bounds_voronoi</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 40 features and 19 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -61.77175 ymin: 46.16256 xmax: -48.20016 ymax: 59.70288</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 40 x 20</span>
<span class="co">#&gt; # Groups:   sfa [4]</span>
<span class="co">#&gt;     year vessel  trip div_nafo season area_swept_km2 year_f n_samples lon_dec</span>
<span class="co">#&gt;  * &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1  1995     39    23 2J       Fall           0.0250 1995           5   -51.9</span>
<span class="co">#&gt;  2  1996     39    37 2G       Fall           0.0250 1996           5   -61.8</span>
<span class="co">#&gt;  3  2011     39    95 2J       Fall           0.0250 2011           5   -49.1</span>
<span class="co">#&gt;  4  2011     39    97 2J       Fall           0.0187 2011           5   -53.7</span>
<span class="co">#&gt;  5  2011     39    98 3K       Fall           0.0281 2011           5   -61.2</span>
<span class="co">#&gt;  6  2006     48   101 2G       Summer         0.0187 2006           5   -57.1</span>
<span class="co">#&gt;  7  2009     48   104 2G       Summer         0.0156 2009           5   -61.3</span>
<span class="co">#&gt;  8  2012     39   107 2H       Fall           0.0187 2012           5   -56.3</span>
<span class="co">#&gt;  9  2012     39   109 3K       Fall           0.0218 2012           5   -50.0</span>
<span class="co">#&gt; 10  2014     63   109 2G       Summer         0.0281 2014           5   -55.4</span>
<span class="co">#&gt; # … with 30 more rows, and 11 more variables: lat_dec &lt;dbl&gt;, depth &lt;dbl&gt;,</span>
<span class="co">#&gt; #   temp_at_bottom &lt;dbl&gt;, weight &lt;dbl&gt;, weight_per_km2 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   recruit_weight &lt;dbl&gt;, row &lt;int&gt;, uniqueID &lt;chr&gt;, geometry &lt;POINT [°]&gt;,</span>
<span class="co">#&gt; #   sfa &lt;chr&gt;, area [km^2]</span></code></pre></div>
<ol>
<li>The next step in this workflow is to smooth the variables to be used in the final <code>sspm</code> model, by using spatial-temporal smoothers, by passing each dataset through <code>spm_smooth</code>. Here we first smooth <code>weight_per_km2</code> as well as <code>temp_at_bottom</code>. Note that the boundary column <code>sfa</code> can be used in the formula as the data will be first joined to the provided boundaries.</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biomass_smooth</span> <span class="op">&lt;-</span> <span class="va">biomass_dataset</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="reference/spm_smooth.html">spm_smooth</a></span><span class="op">(</span><span class="va">weight_per_km2</span> <span class="op">~</span> <span class="va">sfa</span> <span class="op">+</span> <span class="fu"><a href="reference/smooth_time.html">smooth_time</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/smooth_time.html">smooth_space</a></span><span class="op">(</span><span class="op">)</span>,
             boundaries <span class="op">=</span> <span class="va">bounds_voronoi</span>,
             drop.unused.levels <span class="op">=</span> <span class="cn">F</span>, family<span class="op">=</span><span class="va">tw</span>, method<span class="op">=</span> <span class="st">"fREML"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/spm_smooth.html">spm_smooth</a></span><span class="op">(</span><span class="va">temp_at_bottom</span> <span class="op">~</span> <span class="fu"><a href="reference/smooth_time.html">smooth_time</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/smooth_time.html">smooth_space</a></span><span class="op">(</span><span class="op">)</span>,
             drop.unused.levels <span class="op">=</span> <span class="cn">F</span>, family<span class="op">=</span><span class="va">gaussian</span>, method<span class="op">=</span> <span class="st">"fREML"</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Fitting formula: weight_per_km2 ~ sfa + smooth_time(k = 3) + smooth_space() for dataset 'borealis'</span>
<span class="co">#&gt; ℹ  Fitting formula: temp_at_bottom ~ smooth_time(k = 2) + smooth_space() for dataset 'borealis'</span>

<span class="va">biomass_smooth</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Dataset: borealis (biomass) ‒‒</span>
<span class="co">#&gt; →  Data (MAPPED)     : [1025 observations, 21 variables]</span>
<span class="co">#&gt; →  Data unique ID    : uniqueID</span>
<span class="co">#&gt; →  Time col.         : year_f</span>
<span class="co">#&gt; →  Coordinates cols. : lon_dec, lat_dec</span>
<span class="co">#&gt; →  Formulas          : </span>
<span class="co">#&gt;       – weight_per_km2 ~ sfa + smooth_time(k = 3) + smooth_space()</span>
<span class="co">#&gt;       – temp_at_bottom ~ smooth_time(k = 2) + smooth_space()</span>
<span class="co">#&gt; →  Boundaries        : [4 observations, 3 variables]</span>
<span class="co">#&gt; →  Smoothed Data     : [912 observations, 8 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: temp_at_bottom_smooth — weight_per_km2_smooth</span></code></pre></div>
<ol>
<li>The smoothed results for any smoothed variables (listed in “smoothed vars” above) can be easily plotted:</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/spm_plot.html">spm_plot</a></span><span class="op">(</span><span class="va">biomass_smooth</span>, <span class="st">"weight_per_km2_smooth"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
<ol>
<li>We also smooth the <code>weight_per_km2</code> variable in the predator data.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predator_smooth</span> <span class="op">&lt;-</span> <span class="va">predator_dataset</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="reference/spm_smooth.html">spm_smooth</a></span><span class="op">(</span><span class="va">weight_per_km2</span> <span class="op">~</span> <span class="fu"><a href="reference/smooth_time.html">smooth_time</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/smooth_time.html">smooth_space</a></span><span class="op">(</span><span class="op">)</span>,
             boundaries <span class="op">=</span> <span class="va">bounds_voronoi</span>,
             drop.unused.levels <span class="op">=</span> <span class="cn">F</span>, family<span class="op">=</span><span class="va">tw</span>, method<span class="op">=</span> <span class="st">"fREML"</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Fitting formula: weight_per_km2 ~ smooth_time(k = 3) + smooth_space() for dataset 'all_predators'</span>

<span class="va">predator_smooth</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Dataset: all_predators (predictor) ‒‒</span>
<span class="co">#&gt; →  Data (MAPPED)     : [1964 observations, 18 variables]</span>
<span class="co">#&gt; →  Data unique ID    : uniqueID</span>
<span class="co">#&gt; →  Time col.         : year</span>
<span class="co">#&gt; →  Coordinates cols. : lon_dec, lat_dec</span>
<span class="co">#&gt; →  Formulas          : </span>
<span class="co">#&gt;       – weight_per_km2 ~ smooth_time(k = 3) + smooth_space()</span>
<span class="co">#&gt; →  Boundaries        : [4 observations, 3 variables]</span>
<span class="co">#&gt; →  Smoothed Data     : [912 observations, 7 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: weight_per_km2_smooth</span></code></pre></div>
<ol>
<li>Before we assemble the full model with our newly smoothed data, we need to deal with the catch data. We first load the dataset.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">catch_dataset</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/spm_as_dataset.html">spm_as_dataset</a></span><span class="op">(</span><span class="va">catch</span>, name <span class="op">=</span> <span class="st">"catch_data"</span>, 
                 type <span class="op">=</span> <span class="st">"catch"</span>, time_column <span class="op">=</span> <span class="st">"year_f"</span>, 
                 uniqueID <span class="op">=</span> <span class="st">"uniqueID"</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon_start"</span>, <span class="st">"lat_start"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Casting data matrix into simple feature collection using columns: lon_start, lat_start</span>
<span class="co">#&gt; !  Warning: sspm is assuming WGS 84 CRS is to be used for casting</span>

<span class="va">catch_dataset</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Dataset: catch_data (catch) ‒‒</span>
<span class="co">#&gt; →  Data              : [88579 observations, 8 variables]</span>
<span class="co">#&gt; →  Data unique ID    : uniqueID</span>
<span class="co">#&gt; →  Time col.         : year_f</span>
<span class="co">#&gt; →  Coordinates cols. : lon_start, lat_start</span></code></pre></div>
<ol>
<li>We then need to aggregate this data. This illustrate using the <code>spm_aggregate</code> functions. Here we use <code>spm_aggregate_catch</code>:</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biomass_smooth_w_catch</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/spm_aggregate_catch.html">spm_aggregate_catch</a></span><span class="op">(</span>biomass <span class="op">=</span> <span class="va">biomass_smooth</span>, 
                      catch <span class="op">=</span> <span class="va">catch_dataset</span>, 
                      biomass_variable <span class="op">=</span> <span class="st">"weight_per_km2_smooth"</span>,
                      catch_variable <span class="op">=</span> <span class="st">"catch"</span>,
                      fill <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Offsetting biomass with catch data using columns: weight_per_km2_smooth, catch</span>
<span class="va">biomass_smooth_w_catch</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Dataset: borealis (biomass) ‒‒</span>
<span class="co">#&gt; →  Data (MAPPED)     : [1025 observations, 21 variables]</span>
<span class="co">#&gt; →  Data unique ID    : uniqueID</span>
<span class="co">#&gt; →  Time col.         : year_f</span>
<span class="co">#&gt; →  Coordinates cols. : lon_dec, lat_dec</span>
<span class="co">#&gt; →  Formulas          : </span>
<span class="co">#&gt;       – weight_per_km2 ~ sfa + smooth_time(k = 3) + smooth_space()</span>
<span class="co">#&gt;       – temp_at_bottom ~ smooth_time(k = 2) + smooth_space()</span>
<span class="co">#&gt; →  Boundaries        : [4 observations, 3 variables]</span>
<span class="co">#&gt; →  Smoothed Data     : [912 observations, 12 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: temp_at_bottom_smooth — weight_per_km2_smooth</span>
<span class="co">#&gt;    ٭ vars with catch: weight_per_km2_smooth_borealis_with_catch — weight_per_km2_smooth_borealis_with_catch_change</span></code></pre></div>
<ol>
<li>Once data has been smoothed, we can assemble a <code>sspm</code> model object, using one dataset of type biomass, one dataset of type predictor and (optionnaly) a dataset of type catch. If we want to use a</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sspm.html">sspm</a></span><span class="op">(</span>biomass <span class="op">=</span> <span class="va">biomass_smooth_w_catch</span>, 
                   predictors <span class="op">=</span> <span class="va">predator_smooth</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Joining smoothed data from all datasets</span>

<span class="va">sspm_model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Model (2 datasets) ‒‒</span>
<span class="co">#&gt; →  Smoothed Data     : [912 observations, 13 variables]</span>
<span class="co">#&gt;    ٭ smoothed vars: temp_at_bottom_smooth — weight_per_km2_smooth_all_predators — weight_per_km2_smooth_borealis</span>
<span class="co">#&gt;    ٭ vars with catch: weight_per_km2_smooth_borealis_with_catch — weight_per_km2_smooth_borealis_with_catch_change</span></code></pre></div>
<ol>
<li>Before fitting the model, we must split data into test/train with <code>spm_split</code>.</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_model</span> <span class="op">&lt;-</span> <span class="va">sspm_model</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/spm_split.html">spm_split</a></span><span class="op">(</span><span class="va">year_f</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span><span class="op">:</span><span class="fl">2017</span><span class="op">)</span><span class="op">)</span>

<span class="va">sspm_model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Model (2 datasets) ‒‒</span>
<span class="co">#&gt; →  Smoothed Data     : [912 observations, 14 variables] / [874 train, 38 test]</span>
<span class="co">#&gt;    ٭ smoothed vars: temp_at_bottom_smooth — weight_per_km2_smooth_all_predators — weight_per_km2_smooth_borealis</span>
<span class="co">#&gt;    ٭ vars with catch: weight_per_km2_smooth_borealis_with_catch — weight_per_km2_smooth_borealis_with_catch_change</span></code></pre></div>
<ol>
<li>To fit the model, we might be interested in including lagged values. This is done with <code>spm_lag</code>.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_model</span> <span class="op">&lt;-</span> <span class="va">sspm_model</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/spm_lag.html">spm_lag</a></span><span class="op">(</span>vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"weight_per_km2_smooth_borealis_with_catch"</span>, 
                   <span class="st">"weight_per_km2_smooth_all_predators"</span><span class="op">)</span>, 
          n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">sspm_model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Model (2 datasets) ‒‒</span>
<span class="co">#&gt; →  Smoothed Data     : [912 observations, 16 variables] / [874 train, 38 test]</span>
<span class="co">#&gt;    ٭ smoothed vars: temp_at_bottom_smooth — weight_per_km2_smooth_all_predators — weight_per_km2_smooth_borealis</span>
<span class="co">#&gt;    ٭ vars with catch: weight_per_km2_smooth_borealis_with_catch — weight_per_km2_smooth_borealis_with_catch_change — weight_per_km2_smooth_borealis_with_catch_lag_1</span>
<span class="co">#&gt;    ٭ lagged vars: weight_per_km2_smooth_all_predators_lag_1 — weight_per_km2_smooth_borealis_with_catch_lag_1</span></code></pre></div>
<ol>
<li>We can now fit the final spm model with <code>spm</code>.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sspm_model_fit</span> <span class="op">&lt;-</span> <span class="va">sspm_model</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/spm.html">spm</a></span><span class="op">(</span><span class="va">weight_per_km2_smooth_borealis_with_catch</span> <span class="op">~</span> 
        <span class="va">weight_per_km2_smooth_borealis_with_catch_lag_1</span> <span class="op">+</span>
        <span class="va">weight_per_km2_smooth_all_predators_lag_1</span> <span class="op">+</span>
        <span class="fu"><a href="reference/smooth_time.html">smooth_lag</a></span><span class="op">(</span><span class="st">"weight_per_km2_smooth_borealis_with_catch"</span><span class="op">)</span> <span class="op">+</span> 
        <span class="va">temp_at_bottom_smooth</span><span class="op">)</span>
<span class="co">#&gt; ℹ  Fitting SPM formula: weight_per_km2_smooth_borealis_with_catch ~ weight_per_km2_smooth_borealis_with_catch_lag_1 + weight_per_km2_smooth_all_predators_lag_1 + smooth_lag('weight_per_km2_smooth_borealis_with_catch') + temp_at_bottom_smooth</span>

<span class="va">sspm_model_fit</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ‒‒ SSPM Model Fit ‒‒</span>
<span class="co">#&gt; →  Smoothed Data     : [912 observations, 16 variables] / [874 train, 38 test]</span>
<span class="co">#&gt; →  Fit summary       : </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: Scaled t(3,7.169) </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; weight_per_km2_smooth_borealis_with_catch ~ weight_per_km2_smooth_borealis_with_catch_lag_1 + </span>
<span class="co">#&gt;     weight_per_km2_smooth_all_predators_lag_1 + temp_at_bottom_smooth + </span>
<span class="co">#&gt;     s(lag_matrix, k = 5, m = 1, by = by_matrix)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parametric coefficients:</span>
<span class="co">#&gt;                                                  Estimate Std. Error t value</span>
<span class="co">#&gt; (Intercept)                                     45.116139  18.197986   2.479</span>
<span class="co">#&gt; weight_per_km2_smooth_borealis_with_catch_lag_1  0.929307   0.010754  86.416</span>
<span class="co">#&gt; weight_per_km2_smooth_all_predators_lag_1       -0.009854   0.003804  -2.591</span>
<span class="co">#&gt; temp_at_bottom_smooth                            0.828527   0.775080   1.069</span>
<span class="co">#&gt;                                                 Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)                                      0.01336 *  </span>
<span class="co">#&gt; weight_per_km2_smooth_borealis_with_catch_lag_1  &lt; 2e-16 ***</span>
<span class="co">#&gt; weight_per_km2_smooth_all_predators_lag_1        0.00974 ** </span>
<span class="co">#&gt; temp_at_bottom_smooth                            0.28539    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Approximate significance of smooth terms:</span>
<span class="co">#&gt;                            edf Ref.df     F p-value  </span>
<span class="co">#&gt; s(lag_matrix):by_matrix 0.8385      5 1.027  0.0135 *</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R-sq.(adj) =  0.855   Deviance explained = 70.8%</span>
<span class="co">#&gt; -REML = 1190.2  Scale est. = 1         n = 874</span></code></pre></div>
<ol>
<li>Plotting the object produces a actual vs predicted plot (with TEST/TRAIN data highlighted.</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/spm_plot.html">spm_plot</a></span><span class="op">(</span><span class="va">sspm_model_fit</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-18-1.png" width="100%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/pedersen-fisheries-lab/sspm/">https://​github.com/​pedersen-fisheries-lab/​sspm/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/pedersen-fisheries-lab/sspm/issues">https://​github.com/​pedersen-fisheries-lab/​sspm/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Valentin Lucet <br><small class="roles"> Author, maintainer </small>  </li>
<li>Eric Pedersen <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://opensource.org/licenses/MIT/"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></li>
<li><a href="https://github.com/pedersen-fisheries-lab/sspm/actions"><img src="https://github.com/pedersen-fisheries-lab/sspm/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/pedersen-fisheries-lab/sspm?branch=main"><img src="https://codecov.io/gh/pedersen-fisheries-lab/sspm/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Valentin Lucet, Eric Pedersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
